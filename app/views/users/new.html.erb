<div class="span-17 last section_margin_top" id="header_wrapper">
  <h1>Sign up</h1>
</div>
<div class="span-12 last section">
	<% form_for @user do |f| %>
	  <div class="span-12 last">
  		<% if @user.errors[:email].any? %><div class="error"><%= f.label :email %>
  		<%= @user.errors[:email].join('<br/>') %></div><br/>
  		<% else %>
      <%= f.label :email %><br/>
  		<% end %>
  		<%= f.text_field :email %><br />
  		<br />
  		<%= f.label :password %><br />
  		<%= f.password_field :password %><br />
  		<br />
  		<%= f.label :password_confirmation %><br />
  		<%= f.password_field :password_confirmation, :'data-return_submit' => true %><br />
      <br/>
      <%= hidden_field_tag :rate_class, params[:rate_class], :id => "rate_class_field" %>
      <%= hidden_field_tag :frequency, params[:frequency], :id => "frequency_field" %>
    </div>
    <div class="span-12 last">
        <div class="section_rule">&nbsp;</div>
        <%= label 'card[name]', "Name on Card" %><br/>
        <%= text_field_tag 'card[name]', nil %><br/>
        <br/>
        <%= label 'card[number]', "Credit Card Number" %><br/>
        <%= text_field_tag 'card[number]', nil %><br/>
        <br/>
        <div class="span-12">
          <div class="span-5">
          <%= label 'card[cvv]', "Security Code" %><br/>
          <%= text_field_tag 'card[cvv]', nil %><br/>
          </div>
          <div class="span-7 last">
            <div class="span-6">
            I have read and I agree to the<br/> <%= link_to 'Terms of Service', terms_url %> and the<br/> <%= link_to 'Privacy Policy', privacy_url %>.
            </div>
            <div class="span-1 last">
              <%= f.check_box :tos_agreed %>
            </div>
          </div>
        </div>
        &nbsp;
        <br/>
        <%= label nil, "Expiration Date" %><br/>
    </div>
    <div class="span-12 last">
      <div class="span-7">
        <%= select_tag 'card[month]', options_for_select( Array.new(12){|i| i+1}.map{|m| [m,m]},1) %> /
        <%= select_tag 'card[year]', options_for_select( Array.new(10){|i| i + Date.today.year}.map{|year| [year,year]},Date.today.year) %>
      </div>
      <div id="create_account_button">
        <div id="create_account_stretcher">
        	<div class="row_item button round light" data-button="true" data-submit="true" onclick="void(0)">
        	  <div class="button_content">Create My Account</div>
        	</div>
        </div>
    	</div>
    </div>
	<% end %>
</div>
<%= javascript_tag do %>
rates = {'BasicRate':{},'SuperRate':{},'UnlimitedRate':{}};
<% Rate.all.each do |rate| %>
  rates['<%= rate.class.name %>']['<%= rate.frequency %>'] = {'amount':'<%= rate.amount.format %>','frequency':'<%= rate.frequency_display %>'};
<% end %>
function selectOption(e){
  e.stopPropagation();
  jQuery(this).add(jQuery(this).siblings()).css('top', (-26 * jQuery(this).parent().children().index(jQuery(this))) + 'px');
  jQuery(this).parent().height(26);
  jQuery(this).parent().children('.selectable').unbind('click',selectOption);
  hiddenFieldProxy(e);
  setPriceDisplay();
}
function setPriceDisplay(){
  jQuery('#option_amount').html(rates[jQuery('#rate_class_field').val()][jQuery('#frequency_field').val()].amount);
  jQuery('#option_frequency').html(rates[jQuery('#rate_class_field').val()][jQuery('#frequency_field').val()].frequency);
}
jQuery(document).ready(function(){
  jQuery('.selectable_group').click(function(e){
    jQuery(this).height(jQuery(this).children().length * 26);
    jQuery(this).children('.selectable').css('top','0px');
    jQuery(this).children('.selectable').bind('click',selectOption);
  })
  bindClickToSelect();
  bindHiddenFieldProxy();
  setPriceDisplay();
})
<% end %>