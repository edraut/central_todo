<div id="project_page_<%= @project.id %>" class="pager" data-children_pages="({'<%= comments_plan_url(@project) %>':'comments_project_page_<%= @project.id %>','<%= edit_plan_url(@project) %>':'info_plan_url_<%= @project.id %>',<% if @project.tasks.active.any? %>'<%= multiple_tasks_url(:ids => @project.tasks.active.ordered.map{|t| t.id}.join(','),:app_context => @app_context) %>':'multiple_tasks_page_<%= @project.tasks.active.ordered.map{|t| t.id}.join('_') %>',<% end %><% if @app_context == 'folder' %>'<%= show_full_folder_url(@project.folder_id) %>':'folder_page_<%= @project.folder_id %>'<% else %>'<%= show_full_user_url(@app_context.to_i) %>':'contact_page_<%= @app_context %>'<% end %>})" data-direct_url="<%= plan_path(@project, :app_context => @app_context) %>">
<%= render :partial => '/layouts/subnav' %>
<div class="page_layout">
<h2><span class="user_title"<% if @project.all_complete? %> class="completed"<% end %>> <%= truncate_clean(@project.title, :length => 256, :omission => '...', :max_word_length => 20) %></span></h2>
<%= render :partial => 'tabs' %>
<div class="list_container">
<% if @project.archived? %>
<div class="block">
  <div class="padding">
  You archived this plan. If you would like to re-activate it, click on the 'edit plan' tab above and uncheck the box next to 'archived'.
  </div>
</div>
<% else %>
<div class="dialog" data-behavior="expander" data-state="expanded" data-style="visibility" data-id="new_task_form" style="visibility:hidden;">
  <div class="padding">
  <%= render :partial => '/tasks/new', :locals => {:project => @project, :sortable => true} %>
  </div>
</div>
<% end %>
	<div data-role="list" id="unarchived_items_wrapper" class="block" data-behavior="expander" data-state="contracted" data-id="new_task_form">
    <div class="row">
  	  <div class="row_item padding_left">
    		<h2 id="active_task_title"><% if @project.tasks.unarchived.any? %>Active Tasks<% elsif @project.tasks.any? %>No active tasks.<% elsif @this_user.tasks.any? %>Add a Task<% else %>Add your first task.<% end %></h2>
      </div>
      <% unless @project.archived? %>
  	  <div class="row_item">&nbsp;&nbsp;</div>
      <div class="row_item control_font button round color2 circle" onclick="void(0)" data-behavior="expander" data-action="expand" data-state="contracted" data-id="new_task_form" data-button="true">+</div>
      <% end %>
    </div>
    <% if @this_user.tasks.any? %>
    <div id="project_<%= @project.id %>_task_list" class="block" data-sort_container="true" data-sort_url="<%= sort_tasks_plan_url(@project) %>" data-sort_id="plan_<%= @project.id %>_task_list">
		<% @project.tasks.active.ordered.each_with_index do |task,index| %>
		  <div id="task_<%= task.id %>" data-role="list_item" data-id="task_<%= task.id %>" data-sort_element="true" data-sort_id="plan_<%= @project.id %>_task_list" class="section" data-list_index="<%= index %>">
				<%= render :partial => '/tasks/show', :locals => {:task => task, :sortable => true, :pager_target => "multiple_tasks_page_#{@project.tasks.active.ordered.map{|t| t.id}.join('_')}"} %>
			</div>
		<% end %>
		</div>
		<% end %>
	</div>
	<div class="block"><div class="padding">
<div id="archive_completed_items" class="list_action" <% unless @project.tasks.complete.any? %>style="display: none;"<% end %>>
	<span onclick="void(0)" href="<%= archive_completed_tasks_plan_url(@project) %>"
	 	data-ajax_behavior="ajax_link"
		data-ajax_method="GET"
		data-ajax_success_callback="handleArchivementSuccess(true);"
		class="button round small color2">archive completed tasks</span>
</div>
</div></div>
<div id="archived_item_list" class="block" <% unless @project.tasks.archived.any? %>style="display:none;"<% end %> data-role="list">
	<h2>Archived</h2>
	<div id="archived_items_wrapper" class="block">
	<% @project.tasks.archived.ordered.each_with_index do |task,index| %>
		<div id="task_<%= task.id %>" data-role="list_item" class="section archived" data-list_index="<%= index %>">
			<%= render :partial => '/tasks/show', :locals => {:task => task} %>
		</div>
	<% end %>
	</div>
</div>
</div>
</div>
</div>
