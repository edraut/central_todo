<div class="span-16" id="header_wrapper">
  <div class="span-16 last section_margin_top">
  	<h1>Plan</h1>
  </div>
  <%= render :partial => 'tabs' %>
</div>
<div class="span-17 last page_content">
  <% if @project.archived? %>
  <p>You archived this plan. If you would like to re-activate it, click on the 'edit plan' tab above and uncheck 'archived'.</p>
  <% else %>
	<div id="unarchived_item_list" class="span-16 last">
		<div id="task_list_heading" class="span-16 last">
			<div id="unarchived_item_heading" class="span-14<% if @project.all_complete? %> completed<% end %>">
				<h2><%= @project.title %></h2>
			</div>
		</div>

		<div id="task_list_heading" class="span-16 last section_margin_top" data-behavior="expander" data-state="contracted" data-id="project_<%= @project.id %>_new_task_form">
      <div id="archive_completed_items" class="list_action button round light" <% unless @project.tasks.complete.any? %>style="display: none;"<% end %> onclick="void(0)" data-button="true">
      <div class="button_content">
    	<%= link_to 'archive completed tasks', archive_completed_tasks_plan_url(@project),
    	 	:'data-ajax_behavior' => 'ajax_link',
    		:'data-ajax_method' => 'GET',
    		:'data-ajax_success_callback' => "handleArchivementSuccess(true);",
    		:'data-ajax_error_callback' => "jQuery(this).after('<div id=\"flash_notice\" class=\"flash_notice\"> Oops! We couldn't archive those completed tasks, please contact customer support.</div>');setTimeOut(\"jQuery('#flash_notice').fadeOut(1000);\",3000);" %>
        </div>
    	</div>
			<% if @project.tasks.unarchived.with_due_date.count > 0 %>
		  <div class="list_action button round light" onclick="void(0)" data-button="true">
        <div class="button_content">
      		<%= link_to ('sort by due date', sort_tasks_plan_url(@project) + '?by_due_date=true') %>
        </div>
      </div>
      <% end %>
      	<div class="list_action button round light" data-behavior="expander" data-state="contracted" data-id="project_<%= @project.id %>_new_task_form" onclick="void(0)" data-button="true">
        	<div class="button_content">
            <a href="#" data-behavior="expander" data-action="expand" data-id="project_<%= @project.id %>_new_task_form">add a task</a>
          </div>
        </div>
		</div>
    <%= render :partial => '/tasks/new', :locals => {:project => @project, :sortable => true} %>
		<div id="unarchived_items_wrapper" class="span-16 last list_section section_margin_top" data-role="list">
      <div class="span-16 last line_item">
        <div class="span-13 text_center small">task title</div>
        <div class="span-3 last small">due date</div>
      </div>
      <div id="project_<%= @project.id %>_task_list" class="span-16 last" data-sort_container="true" data-sort_url="<%= sort_tasks_plan_url(@project) %>" data-sort_id="plan_<%= @project.id %>_task_list">
			<% @project.tasks.unarchived.ordered.each_with_index do |task,index| %>
				<div class="span-16 last line_item" id="task_<%= task.id %>" data-role="list_item" data-sort_element="true" data-sort_id="plan_<%= @project.id %>_task_list">
					<%= render :partial => '/tasks/show', :locals => {:task => task, :sortable => true, :needs_organization => true} %>
				</div>
			<% end %>
			</div>
		</div>
	</div>
  <div class="span-16 last">
  </div>
	<% end %>
	<div id="archived_item_list" <% unless @project.tasks.archived.any? %>style="display:none;"<% end %> class="span-16 last section_margin_top" data-role="list">
		<div id="archived_item_heading" class="span-16 last">
			<h2>You got these done.</h2>
		</div>
		<div id="archived_items_wrapper" class="span-16 last archived list_section">
      <div class="span-16 last line_item">
        <div class="span-11 text_center small">task title</div>
        <div class="span-3 text_center small">due date</div>
      </div>
			<% @archived_tasks.each_with_index do |task,index| %>
				<div class="span-16 last line_item" id="task_<%= task.id %>" data-role="list_item">
					<%= render :partial => '/tasks/show', :locals => {:task => task} %>
				</div>
			<% end %>
		</div>
  	<div class="span-17">
		<%= will_paginate @archived_tasks %>
    </div>
	</div>
</div>
